# heroscript
Console tool for upload tcx activities to velohero by merging Strava activity values.

# Introducing
Velohero is a platform to store your activity files (e.g. TCX). You can maintain additional data like training type, equipments etc. But you have to upload and maintain it by hand (tapikiik dosn't work fine). 

Strava has a nice app and is good for beeing connected with other athletes. My Garmin device sends the activity directly to Strava, so I can edit the activity data directly (Setting a proper name, used equipment etc.)

Heroscript is the bridge between Strava/Garmin to Velohero. It tooks the original TCX file from Garmin, adds the activity settings from Strava, so it can be updloaded without doing any additional value settings. After that, the TCX file will be archived on my local storage server. To bring this concept to work, all activity values have to be set in Strava.

Downloading from Garmin is out of scope, I use a fork of garmin-connect-export to download all new activities.

Heroscript is not a ready-to-use GUI application for the normal athlete. It is a tailored console script, designed for just my specific use case. But may be you have a similar constellation, so this script can help you as a starting point.

![Overview](https://github.com/chs8691/heroscript/blob/master/design/Diagram.png)

# Preconditions

## Python
You need Python 3.x on your local machine. The scripting is done on Ubuntu and should work an all Ubuntu environments, too. To use it on Windows or your own virtual environment, see requirements.txt for the used libraries (generated by pipreqs).

## Velohero
You need a Velohero account, of course. Set up heroscript with the Single-Sign-On ID from Velohero / Hello / Single-Sign-On / Single Sign On ID. For instance: 

$ heroscript config --velohero_sso_id kdRfmIHT6IVH1GI12345BIhaUpwTaQguuzE7FFs4

## STRAVA
For STRAVA, you need an to create an API whith a call back domain 'localhost'. From this API, you need the client ID and the Client Secret. Configure heroscript with this values:

$ venv/bin/python main.py config --strava_client_id 12345
$ venv/bin/python main.py config --strava_client_secret 509d7ed7ab29c93bb12345a05f3a1627c57e413f

## Local Web Server
A local webserver is used for STRAVA authentication. This server has a default port '4312' but can be change with the config command. For instance:

$ venv/bin/python main.py config --port 4444

# Install
Clone the repository and open a shell

## Usage
Heroscript can be explored by using its help:
 
$ venv/bin/python main.py --help

There are a couple of commands, but for the main use case, you just need this one:

### Setup Commands
* config: Settings for authorization, directories etc.
* masterdata: Read equipments from Velohero and Strava and training types from Velohero

### Activity Commands
* load: Read next TCX file from the local download direcory and merge its Strava activity settings
* transfer: Upload activity to Velohero, update Strava activity and move TCX file to the local archive directory

Let's take a look at the same workflow diagram from above. But now with the heroscript commands instead of the action descriptions.

![Overview](https://github.com/chs8691/heroscript/blob/master/design/commands.png)


### Example
Step by step example to show how it works. If you want to download the latest activities from Garmin in the in-directory, you can do this with ![chs8691/garmin-connect-export](https://github.com/chs8691/garmin-connect-export). This is forked from pe-st's one and can download only new activities:

$ garmin-connect-export --username <YOUR-GARMIN-USER > --password <TOP-SECRET-PASSWORD> -d /home/chris/download -f tcx -s tcx -fp -c new
 
This will download all new activities from Garmin Connect into your local directory '/home/chris/download'.

Next, we will setup the master data.

Velohero's Training Types will be used in heroscript (later on, it is shown how to set a training type in a Strava activity):

![Training Types in Velohero](https://github.com/chs8691/heroscript/blob/master/design/training-types.png)

To use the equipments, you have to maintain all equipments in Velohero and Strava with the same name (other ones will be ignored):
 
![Equipments in Velohero and Strava](https://github.com/chs8691/heroscript/blob/master/design/equipments.png)

This pairs of equipments can now be merged as master data into heroscript. Because this is the first time to connect to Strava, you have to accecpt authoriztion for the heroscript app:

$ venv/bin/python main.py masterdata --refresh
$ Collecting data from Velohero..done! From Strava..Starting webbrowser, please authorize heroscript for STRAVA access.
Waiting 10 sec for your authorization:  0

![Strava authorization for heroscript](https://github.com/chs8691/heroscript/blob/master/design/strava_authorization.png)

After acception the rights, the master data will be merged:

$ venv/bin/python main.py masterdata --list

Now setup heroscript for download and archive directories:
 
 $ venv/bin/python main.py config --load_dir=/home/chris/download/
 $ venv/bin/python main.py config --archive_dir=/home/chris/archive/
 
 If heroscript should not use the default port 4312, specify another one:
 
 $ venv/bin/python main.py config --port 4313
 
 For Velohero you have to set the SSO-ID:
 
 $ venv/bin/python main.py config -vs feQfmIHT6IVH1GI9SD32BIhaUpwTaQguuzE7XXa2
 
 
 
 





